on:	
  push:	
    branches:	
      - master	
#  workflow_dispatch:	

env:
  AZURE_WEBAPP_NAME: 'folderaccess-check'  # set this to your application's name
  AZURE_WEBAPP_PACKAGE_PATH: .             # set this to the path to your web app project, defaults to the repository root
  DOTNET_VERSION: '3.1.301'                # set this to the node version to use

jobs:	
  build-and-deploy:	
    runs-on: windows-latest	

    steps:	
    - uses: actions/checkout@v2	

    - name: Set up .NET Core	
      uses: actions/setup-dotnet@v1	
      with:	
        dotnet-version: '3.1.301'	
        include-prerelease: true	

    - name: Build with dotnet	
      run: dotnet build --configuration Release	

    - name: dotnet publish	
      run: dotnet publish -c Release -o ${{env.DOTNET_ROOT}}/myapp	

    - name: Upload artifact for deployment job	
      uses: actions/upload-artifact@v2	
      with:	
        name: .net-app	
        path: ${{env.DOTNET_ROOT}}/myapp	

  #deploy:	
  #  runs-on: windows-latest	
  #  needs: build	
  #  environment:	
  #    name: 'production'	
  #    url: ${{ steps.deploy-to-webapp.outputs.webapp-url }}	

  #  steps:	
    - name: Download artifact from build job	
      uses: actions/download-artifact@v2	
      with:	
        name: .net-app	

    - name: Deploy to Azure Web App	
      id: deploy-to-webapp	
      uses: azure/webapps-deploy@v2	
      with:	
        app-name: 'folderaccess-check'	
        slot-name: 'production'	
        publish-profile: ${{ secrets.AzureAppService_PublishProfile_22823d8812bd491b9ca52d833ec87d30 }}	
        package: .	
